{% extends 'base.html' %}
{% block title %}Hospital Appointment TimeSlot Page{% endblock title %}
{% block content %}

<style>
.btn {
    margin: 2%;
}
.btn-custom:hover,
.btn-custom.active{
  background-color: #414146;
}
.btn-custom.active:hover {
  background-color: #414146;
}
.btn-custom {
  border-color: #32c69a;
}

</style>
<div class="container">
    <div class="page-header">
        <center><h2>
            Book Appointments
        </h2></center>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="date-picker-2"  id="ttry" aria-describedby="basic-addon2"></div>
        </div>

        <div class="col-md-8" id="slot-display" style="display: None;">
<!--            {% for i in data.doc_time_slot.all %}-->
<!--                {{ i.from_time }}-->
<!--            {% endfor %}-->





        </div>

        <input type="hidden" name="date" id="date">
    </div>

</div>
{% endblock %}
{% block js %}
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">


<script>
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
        }
    }
});
$('.date-picker-2').popover({
	html : true,
	content: function() {
	  return $("#example-popover-2-content").html();
	},
	title: function() {
	  return $("#example-popover-2-title").html();
	},
	time_slot: function() {
	    return $("#slot-display").html();
	}
});
  var dateToday = new Date();

$(".date-picker-2").datepicker({
     minDate: dateToday,
	onSelect: function(dateText) {
	 var current_date = $(this).val();
     $('#date').val(current_date);

        var url = "{% url 'hospital:appointment_slot' data.id %}";
        $.ajax({
             url:  url,
             type : "POST",
             data : { select_date : $('#date').val(),
                      },

            success: function(response) {
                 $('#slot-display').show();
                 $('#slot-display').html(response.html);

                 console.log(response);
            },
            error: function(response) {
                console.log(response);
            }
        });

    }
});
$('.ui-datepicker-current-day').click();

</script>
{% endblock %}